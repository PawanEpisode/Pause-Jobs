!function(){"use strict";function a(a){function b(b,c,d){if(!c||"string"!=typeof c)throw Error("Second parameter should be a node selector");if(a){b=b.split(" ");for(var e in b)document.querySelector(a).addEventListener(b[e],function(b){var e=b||window.event,f=e.target||e.srcElement,g=document.querySelectorAll(a+" "+c);if(g.length)for(var h=0,i=g.length;h<i;h++)if(f===g[h])return d(b),!1},!0)}}return{deligate:b}}!function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(a){for(var b=(this.document||this.ownerDocument).querySelectorAll(a),c=b.length;--c>=0&&b.item(c)!==this;);return c>-1})}();var b=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(){function d(a){b(this,d),this.url=a.dataURL,this.appId=a.appId,this.tagName=a.tagName}return c(d,[{key:"bind",value:function(a){var b=this;try{var c=a.forms;if(c!==!1){this.tagName=a.tagName||this.tagName,this.source=a.source||"",this.tnmObject={},this.tnmObject.form={},this.tnmObject.timeStart=+new Date,"[object Array]"!==Object.prototype.toString.call(c)&&(c=document.querySelectorAll("form"));for(var d=0,e=c.length;d<e;d++)c[d]&&c[d].name&&this.extractNode(c[d])}this.linkBinding(),window.onbeforeunload=function(){b.tnmObject.exitAction="reload/close",b.send()}}catch(f){}}},{key:"logError",value:function(a){var b=this;try{var c=function(c,d,e){c.fields=c.fields||{};for(var f=c.fields,g=d.querySelectorAll('[name]:not([type="hidden"])'),h=a.node&&"hidden"==a.node.type?_this2.getActualComponentElem(a.node,d):a.node&&"hidden"!=a.node.type?[a.node]:g,i=0,j=h.length;i<j;i++){var k=b.getFieldIdentifier(h[i]);if(f[k]=f[k]||{},a.err[k])f[k].isValid=!1,f[k].errors=f[k].errors||[],f[k].errors.push({text:a.err[k],count:1}),a.isSubmit===!1&&(b.tnmObject.lastVisitedField=a.formName+"."+k);else if(null===a.err[k]){f[k].isValid=!0;var l=Array.prototype.indexOf.call(g,a.node),m=l===-1?k:g[++l].name;a.isSubmit===!1&&(b.tnmObject.lastVisitedField=a.formName+"."+m)}}};if(Object.keys(a).length){for(var d=this.tnmObject.form[a.formName],e=document.querySelector('[name="'+a.formName+'"]'),f=e.querySelectorAll("[tnmdependent]"),g=0,h=f.length;g<h;g++)a.err[f[g].name]=a.err[f[g].getAttribute("tnmdependent")];c(d,e)}}catch(i){}}},{key:"send",value:function(){try{if(Object.keys(this.tnmObject).length){this.tnmObject.exitAction||(this.tnmObject.exitAction="other"),this.tnmObject.appId=this.appId,this.tnmObject.source=this.source,this.tnmObject.tag=this.tagName,this.tnmObject.timeSpent=+new Date-this.tnmObject.timeStart;for(var a in this.tnmObject.form)Object.keys(this.tnmObject.form[a]).length||delete this.tnmObject.form[a];delete this.tnmObject.timeStart,navigator.sendBeacon?navigator.sendBeacon(this.url,JSON.stringify(this.tnmObject)):logger.util.reportData(this.tnmObject,this.url)}}catch(b){}}},{key:"logData",value:function(a,b,c,d){var e=this;try{var f=this.getFieldIdentifier(b)||b.getAttribute("cname"),g=d.type,h=this.tnmObject.form[a];h.fields=h.fields||{};var i=h.fields[f]||{};"click|focus".match(g)&&(h.timeSpent=(h.timeSpent||0)+100,("BUTTON"==b.tagName||"INPUT"===b.nodeName&&"submit"==b.type)&&(this.tnmObject.exitAction="submit"),i.visitCount=++i.visitCount||1,this.currentFieldTimeSpan.start=function(){return+new Date}()),"blur"==g&&(this.currentFieldTimeSpan.end=+new Date,i.timeSpent=function(){return(i.timeSpent||0)+(e.currentFieldTimeSpan.end-e.currentFieldTimeSpan.start)}(),h.timeSpent=(h.timeSpent||0)+(this.currentFieldTimeSpan.end-this.currentFieldTimeSpan.start),i.value=c||"",h.lastVisitedField=a+"."+f),this.tnmObject.lastVisitedField=a+"."+f,h.fields[f]=i,this.tnmObject.form[a]=h}catch(j){}}},{key:"getActualComponentElem",value:function(a,b){var c=this.getFieldIdentifier(a);if(c){var d=b.querySelector('[tnmdependent="'+c+'"]');return d?d:""}}},{key:"getCustomComponentValue",value:function(a,b){var c=a.getAttribute("tnmdependent");if(c){var d=b.querySelector('[name="'+c+'"]')||b.querySelector('[id="'+c+'"]');return d?d.value:""}}},{key:"linkBinding",value:function(){for(var a=this,b=document.getElementsByTagName("a"),c=0;c<b.length;c++)b[c].addEventListener("click",function(b){var c=(b.target.nodeName||"")+"_"+(b.target.href||"");a.tnmObject.lastVisitedField=c,a.tnmObject.exitAction="link"})}},{key:"getFieldIdentifier",value:function(a){return a.getAttribute("name")||a.getAttribute("id")}},{key:"focus_blur_handler",value:function(a,b){var c=a.target||a.srcElement,d=c.value;(c.nodeName.match(/^A|BUTTON$/)||"INPUT"===c.nodeName&&"submit"==c.type||this.getFieldIdentifier(c).replace(/^[\s]+|[\s]+$/g,"")||c.getAttribute("tnmdependent"))&&(null!==c.getAttribute("customelement")&&(d=this.getCustomComponentValue(c,b)),this.logData(this.getFieldIdentifier(b),c,d,a))}},{key:"debounce",value:function(a){clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(a,150)}},{key:"extractNode",value:function(b){var c=this,d=this.getFieldIdentifier(b);this.tnmObject.form[d]={},this.currentFieldTimeSpan={},a('[name="'+d+'"]').deligate("focus click",'a, button, input:not([type="hidden"]):not([customelement]), textarea[name]',function(a){c.debounce(function(){c.focus_blur_handler(a,b)})}),a('[name="'+d+'"]').deligate("blur",'a, button, input:not([type="hidden"]):not([customelement]), textarea[name], select',function(a){c.focus_blur_handler(a,b)}),a('[name="'+d+'"]').deligate("focus click change","select",function(a){c.debounce(function(){c.focus_blur_handler(a,b)})}),a('[name="'+d+'"]').deligate("focus click","input[customelement]",function(a){c.debounce(function(){c.focus_blur_handler(a,b)})}),a('[name="'+d+'"]').deligate("blur","input[customelement]",function(a){c.focus_blur_handler(a,b)})}}]),d}(),e=window.logger=window.logger||{};e.tnm={},e.tnm.init=function(a){var b=new d(a);e.tnm.fn=b}}();