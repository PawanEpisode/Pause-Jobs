!function(){"use strict";function e(e){return{deligate:function(t,n,i){if(!n||"string"!=typeof n)throw Error("Second parameter should be a node selector");if(e)for(var r in t=t.split(" "))document.querySelector(e).addEventListener(t[r],function(t){var r=t||window.event,o=r.target||r.srcElement,a=document.querySelectorAll(e+" "+n);if(a.length)for(var c=0,l=a.length;c<l;c++)if(o===a[c])return i(t),!1},!0)}}}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function i(e){t(this,i),this.url=e.dataURL,this.appId=e.appId,this.tenantId=e.tenantId,this.deviceType=e.deviceType,this.eventName=e.eventName,this.tagName=e.tagName}return n(i,[{key:"bind",value:function(e){var t=this;try{var n=e.forms;if(!1!==n){this.tagName=e.tagName||this.tagName,this.tenantId=e.tenantId||this.tenantId,this.deviceType=e.deviceType||this.deviceType||"SERVER",this.eventName=e.eventName||this.eventName||"newMonkTNM",this.source=e.source||"",this.tnmObject={},this.tnmObject.form={},this.tnmObject.timeStart=+new Date,"[object Array]"!==Object.prototype.toString.call(n)&&(n=document.querySelectorAll("form"));for(var i=0,r=n.length;i<r;i++)n[i]&&n[i].name&&this.extractNode(n[i])}this.linkBinding(),window.onbeforeunload=function(){t.tnmObject.exitAction="reload/close",t.send()}}catch(e){console.warn(e)}}},{key:"logError",value:function(e){var t=this;try{if(Object.keys(e).length){for(var n=this.tnmObject.form[e.formName],i=document.querySelector('[name="'+e.formName+'"]'),r=i.querySelectorAll("[tnmdependent]"),o=0,a=r.length;o<a;o++)e.err[r[o].name]=e.err[r[o].getAttribute("tnmdependent")];!function(n,i,r){n.fields=n.fields||{};for(var o=n.fields,a=i.querySelectorAll('[name]:not([type="hidden"])'),c=e.node&&"hidden"==e.node.type?_this2.getActualComponentElem(e.node,i):e.node&&"hidden"!=e.node.type?[e.node]:a,l=0,s=c.length;l<s;l++){var m=t.getFieldIdentifier(c[l]);if(o[m]=o[m]||{},e.err[m])o[m].isValid=!1,o[m].errors=o[m].errors||[],o[m].errors.push({text:e.err[m],count:1}),!1===e.isSubmit&&(t.tnmObject.lastVisitedField=e.formName+"."+m);else if(null===e.err[m]){o[m].isValid=!0;var u=Array.prototype.indexOf.call(a,e.node),d=-1===u?m:a[++u].name;!1===e.isSubmit&&(t.tnmObject.lastVisitedField=e.formName+"."+d)}}}(n,i)}}catch(e){console.warn(e)}}},{key:"send",value:function(){try{if(Object.keys(this.tnmObject).length){for(var e in this.tnmObject.exitAction||(this.tnmObject.exitAction="other"),this.tnmObject.tenantId=this.tenantId,this.tnmObject.deviceType=this.deviceType,this.tnmObject.eventName=this.eventName,this.tnmObject.appId=this.appId,this.tnmObject.source=this.source,this.tnmObject.tag=this.tagName,this.tnmObject.timeSpent=+new Date-this.tnmObject.timeStart,this.tnmObject.form)Object.keys(this.tnmObject.form[e]).length||delete this.tnmObject.form[e];delete this.tnmObject.timeStart,navigator.sendBeacon?navigator.sendBeacon(this.url,JSON.stringify(this.tnmObject)):logger.util.reportData(this.tnmObject,this.url)}}catch(e){console.warn(e)}}},{key:"logData",value:function(e,t,n,i){var r=this;try{var o=this.getFieldIdentifier(t)||t.getAttribute("cname"),a=i.type,c=this.tnmObject.form[e];c.fields=c.fields||{};var l=c.fields[o]||{};"click|focus".match(a)&&(c.timeSpent=(c.timeSpent||0)+100,("BUTTON"==t.tagName||"INPUT"===t.nodeName&&"submit"==t.type)&&(this.tnmObject.exitAction="submit"),l.visitCount=++l.visitCount||1,this.currentFieldTimeSpan.start=+new Date),"blur"==a&&(this.currentFieldTimeSpan.end=+new Date,l.timeSpent=(l.timeSpent||0)+(r.currentFieldTimeSpan.end-r.currentFieldTimeSpan.start),c.timeSpent=(c.timeSpent||0)+(this.currentFieldTimeSpan.end-this.currentFieldTimeSpan.start),l.value=n||"",c.lastVisitedField=e+"."+o),this.tnmObject.lastVisitedField=e+"."+o,c.fields[o]=l,this.tnmObject.form[e]=c}catch(e){console.warn(e)}}},{key:"getActualComponentElem",value:function(e,t){var n=this.getFieldIdentifier(e);if(n){var i=t.querySelector('[tnmdependent="'+n+'"]');return i||""}}},{key:"getCustomComponentValue",value:function(e,t){var n=e.getAttribute("tnmdependent");if(n){var i=t.querySelector('[name="'+n+'"]')||t.querySelector('[id="'+n+'"]');return i?i.value:""}}},{key:"linkBinding",value:function(){for(var e=this,t=document.getElementsByTagName("a"),n=0;n<t.length;n++)t[n].addEventListener("click",function(t){var n=(t.target.nodeName||"")+"_"+(t.target.href||"");e.tnmObject.lastVisitedField=n,e.tnmObject.exitAction="link"})}},{key:"getFieldIdentifier",value:function(e){return e.getAttribute("name")||e.getAttribute("id")}},{key:"focus_blur_handler",value:function(e,t){var n=e.target||e.srcElement,i=n.value;(n.nodeName.match(/^A|BUTTON$/)||"INPUT"===n.nodeName&&"submit"==n.type||this.getFieldIdentifier(n).replace(/^[\s]+|[\s]+$/g,"")||n.getAttribute("tnmdependent"))&&(null!==n.getAttribute("customelement")&&(i=this.getCustomComponentValue(n,t)),this.logData(this.getFieldIdentifier(t),n,i,e))}},{key:"debounce",value:function(e){clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(e,150)}},{key:"extractNode",value:function(t){var n=this,i=this.getFieldIdentifier(t);this.tnmObject.form[i]={},this.currentFieldTimeSpan={},e('[name="'+i+'"]').deligate("focus click",'a, button, input:not([type="hidden"]):not([customelement]), textarea[name]',function(e){n.debounce(function(){n.focus_blur_handler(e,t)})}),e('[name="'+i+'"]').deligate("blur",'a, button, input:not([type="hidden"]):not([customelement]), textarea[name], select',function(e){n.focus_blur_handler(e,t)}),e('[name="'+i+'"]').deligate("focus click change","select",function(e){n.debounce(function(){n.focus_blur_handler(e,t)})}),e('[name="'+i+'"]').deligate("focus click","input[customelement]",function(e){n.debounce(function(){n.focus_blur_handler(e,t)})}),e('[name="'+i+'"]').deligate("blur","input[customelement]",function(e){n.focus_blur_handler(e,t)})}}]),i}(),r=window.logger=window.logger||{};r.tnm={},r.tnm.init=function(e){var t=new i(e);r.tnm.fn=t}}();